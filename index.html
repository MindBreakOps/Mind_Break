<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>MBO | Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://unpkg.com/lucide@latest"></script>
	<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
		body { font-family: 'Tajawal', sans-serif; background-color: #F8F5EE; color: #331111; overflow-x: hidden; }
		.glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(15px); border: 1px solid white; border-radius: 2rem; }
		.page-content { display: none; padding-bottom: 120px; }
		.active { display: block; animation: slideUp 0.3s ease-out; }
		@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
		.nav-active { background: #632323 !important; color: white !important; }
		.invoice-card { background: white; padding: 20px; border-radius: 1.5rem; border: 1px solid #eee; margin-bottom: 15px; }
		input, select { outline: none !important; border: 1px solid #f0f0f0 !important; width: 100%; padding: 1.2rem; border-radius: 1.2rem; background: white; font-weight: bold; font-size: 1rem; }
		input:focus { border-color: #632323 !important; box-shadow: 0 0 0 3px rgba(99, 35, 35, 0.05); }
		.badge-free { background: #E8F5E9; color: #2E7D32; padding: 4px 12px; border-radius: 8px; font-size: 10px; font-weight: 900; }
	</style>
</head>
<body>

	<section id="login-page" class="fixed inset-0 z-[100] bg-[#F8F5EE] flex items-center justify-center p-6">
		<div class="glass p-10 w-full max-w-sm text-center shadow-2xl border-2 border-[#632323]/5">
			<div class="w-20 h-20 border-2 border-[#632323] p-1 rounded-full mx-auto mb-6 flex items-center justify-center bg-white shadow-md">
				<img src="mind.png" class="w-12 h-12 object-contain" onerror="this.src='https://via.placeholder.com/100?text=MB'">
			</div>
			<h2 class="text-xl font-black text-[#632323] mb-8 italic uppercase tracking-tighter">MIND BREAK SYSTEM</h2>
			<div class="space-y-4">
				<input type="text" id="login-user" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="text-center">
				<input type="password" id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="text-center">
				<button onclick="handleLogin()" id="login-btn" class="w-full bg-[#632323] text-white py-4 rounded-2xl font-black active:scale-95 transition-all shadow-lg shadow-[#632323]/20">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
			</div>
		</div>
	</section>

	<div id="main-app" class="hidden">
		<header class="p-6 flex justify-between items-center max-w-4xl mx-auto">
			<div class="flex items-center gap-3">
				<div class="w-12 h-12 border-2 border-[#632323] rounded-full p-1 bg-white flex items-center justify-center shadow-sm">
					<img src="mind.png" class="w-8 h-8 object-contain">
				</div>
				<div>
					<h1 id="user-display" class="font-black text-[#632323] text-sm"></h1>
					<span id="role-tag" class="text-[9px] bg-[#632323] text-white px-2 py-0.5 rounded-md font-bold uppercase"></span>
				</div>
			</div>
			<button onclick="location.reload()" class="p-3 bg-white rounded-xl shadow-sm text-red-500 active:bg-red-50"><i data-lucide="power" size="20"></i></button>
		</header>

		<main class="max-w-4xl mx-auto px-6">
			<section id="dashboard" class="page-content">
				<div class="flex gap-2 mb-6">
					<button onclick="switchTab('mb')" id="tab-mb" class="flex-1 py-3 rounded-2xl font-bold bg-[#632323] text-white shadow-lg transition-all">Ø¹Ø¶Ùˆ Mind Break</button>
					<button onclick="switchTab('external')" id="tab-ext" class="flex-1 py-3 rounded-2xl font-bold bg-white text-[#632323] border border-[#eee]">Ø¹Ù…ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ</button>
				</div>
				<div class="glass p-6 shadow-xl space-y-4">
					<div id="form-fields" class="space-y-4"></div>
					<button onclick="saveProcess()" id="save-btn" class="w-full bg-[#632323] text-white py-5 rounded-3xl font-black mt-6 shadow-xl active:scale-95 transition-all">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
				</div>
			</section>

			<section id="reports" class="page-content">
				<div class="flex justify-between items-center mb-6">
					<h2 class="text-2xl font-black text-[#632323]">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
					<button onclick="loadReports()" class="p-2 bg-white rounded-full shadow-sm active:rotate-180 transition-all"><i data-lucide="rotate-cw" size="18"></i></button>
				</div>
				<div id="reports-list" class="space-y-4"></div>
			</section>

			<section id="attendance" class="page-content">
				<h2 class="text-2xl font-black text-[#632323] mb-6 text-center">Ø³Ø¬Ù„ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙŠØ¯ÙˆÙŠ</h2>
				<div id="attendance-list" class="space-y-3"></div>
			</section>
		</main>

		<nav id="nav-bar" class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[92%] max-w-md glass p-2 flex justify-around shadow-2xl z-[90]">
			<button onclick="navTo('dashboard')" id="nav-dashboard" class="p-4 rounded-[1.5rem] transition-all"><i data-lucide="plus-square"></i></button>
			<button onclick="navTo('reports')" id="nav-reports" class="p-4 rounded-[1.5rem] transition-all"><i data-lucide="clipboard-list"></i></button>
			<a href="https://mindbreakops.github.io/MBO-HumanResourceSystem/" target="_blank" class="p-4 rounded-[1.5rem] flex items-center justify-center bg-gray-50/50">
				<i data-lucide="fingerprint" class="text-[#632323]"></i>
			</a>
			<button onclick="navTo('attendance')" id="nav-attendance" class="p-4 rounded-[1.5rem] transition-all hidden"><i data-lucide="users"></i></button>
		</nav>
	</div>

	<div id="receipt-capture" class="fixed -left-[2000px] bg-white p-10 w-[400px] text-center border-4 border-[#632323]">
		<div class="w-24 h-24 border-2 border-[#632323] p-1 rounded-full mx-auto mb-6 flex items-center justify-center bg-white">
			<img src="mind.png" class="w-16 h-16">
		</div>
		<h2 class="font-black text-3xl text-[#632323] border-b-2 border-dashed pb-6 mb-6 uppercase italic tracking-tighter">MIND BREAK</h2>
		<div id="cap-data" class="space-y-4 text-2xl text-right font-bold"></div>
		<div class="mt-8 pt-4 border-t border-dashed text-right text-sm">
			<p class="opacity-60">Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: <span id="cap-staff-name" class="text-black font-black"></span></p>
			<p id="cap-time" class="opacity-40 text-[10px] mt-2 font-mono"></p>
		</div>
	</div>

	<script>
		const API_URL = 'https://script.google.com/macros/s/AKfycbxBgJQTQHEsQgmXpe0UmJ18MFgoyuKpwrCayzN65JaC_NasKeDCNDDTHwIcEIb9KJPO/exec';
		let currentUser = null;
		let currentMode = 'mb';

		async function handleLogin() {
			const user = document.getElementById('login-user').value.trim();
			const pass = document.getElementById('login-pass').value.trim();
			if(!user || !pass) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
			const btn = document.getElementById('login-btn');
			btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..."; btn.disabled = true;
			try {
				const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'login', user, pass }) });
				const result = await res.json();
				if(result.status === "success") { currentUser = result; setupUI(); } 
				else { alert("Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„"); }
			} catch(e) { alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±"); }
			btn.innerText = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"; btn.disabled = false;
		}

		function setupUI() {
			document.getElementById('login-page').classList.add('hidden');
			document.getElementById('main-app').classList.remove('hidden');
			document.getElementById('user-display').innerText = `Ø£Ù‡Ù„Ø§Ù‹ØŒ ${currentUser.name}`;
			document.getElementById('role-tag').innerText = currentUser.role;
			if(currentUser.role === 'Admin') document.getElementById('nav-attendance').classList.remove('hidden');
			navTo('dashboard');
		}

		function switchTab(mode) {
			currentMode = mode;
			const container = document.getElementById('form-fields');
			if(mode === 'mb') {
				document.getElementById('tab-mb').className = "flex-1 py-3 rounded-2xl font-bold bg-[#632323] text-white shadow-lg";
				document.getElementById('tab-ext').className = "flex-1 py-3 rounded-2xl font-bold bg-white text-[#632323] border border-[#eee]";
				container.innerHTML = `
					<div class="flex justify-between items-center mb-1"><span class="text-xs font-black">Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</span> <span class="badge-free">FREE SERVICE</span></div>
					<input type="text" id="clientName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ">
					<input type="text" id="plateNum" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© (Ø£ Ø¨ Ø¬ 123)" class="text-center text-xl">
					<input type="number" id="cardNum" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Øª" class="text-center text-xl">
				`;
			} else {
				document.getElementById('tab-ext').className = "flex-1 py-3 rounded-2xl font-bold bg-[#632323] text-white shadow-lg";
				document.getElementById('tab-mb').className = "flex-1 py-3 rounded-2xl font-bold bg-white text-[#632323] border border-[#eee]";
				container.innerHTML = `
					<input type="text" id="clientName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ">
					<input type="number" id="clientPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
					<input type="text" id="plateNum" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©" class="text-center text-xl">
					<input type="number" id="cardNum" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒØ±Øª" class="text-center text-xl">
				`;
			}
		}

		async function saveProcess() {
    const plate = document.getElementById('plateNum').value;
    const card = document.getElementById('cardNum').value;
    const client = document.getElementById('clientName').value;
    // Ø³Ø­Ø¨ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠØ§Ù‹ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø¶Ø¹ "-"
    const phone = (currentMode === 'external') ? (document.getElementById('clientPhone').value || '-') : '-';

    if(!plate || !card || !client) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„!");

    const data = {
        action: 'saveInvoice', 
        plateNum: plate, 
        cardNum: card, 
        clientName: client, // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… ØµØ­ÙŠØ­Ø§Ù‹ Ù‡Ù†Ø§
        valetName: currentUser.name,
        serviceType: currentMode === 'mb' ? 'Free' : 'Paid', 
        amount: currentMode === 'mb' ? 0 : 25,
        phoneNum: phone, // ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù…Ø³Ù…Ù‰ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        status: 'Parked'
    };

    const btn = document.getElementById('save-btn');
    btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

    try {
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ±
        await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©
        await captureAndDownload(data);
        
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ¥ØµØ¯Ø§Ø± Ø§Ù„Ø¥ÙŠØµØ§Ù„!");
        switchTab(currentMode); // Ø¥Ø¹Ø§Ø¯Ø© ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„
    } catch(e) { 
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"); 
    }
    btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ ÙˆØ­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©";
}

async function captureAndDownload(data) {
    const cap = document.getElementById('receipt-capture');
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ§Ø±ØºØ©
    document.getElementById('cap-data').innerHTML = `
        <div class="flex justify-between border-b pb-2"><span>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</span><span>${data.clientName || '-'}</span></div>
        <div class="flex justify-between border-b pb-2"><span>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span><span>${data.phoneNum || '-'}</span></div>
        <div class="flex justify-between border-b pb-2"><span>Ø§Ù„Ù„ÙˆØ­Ø©:</span><span>${data.plateNum}</span></div>
        <div class="flex justify-between border-b pb-2"><span>Ø§Ù„ÙƒØ±Øª:</span><span>#${data.cardNum}</span></div>
        <div class="flex justify-between border-b pb-2"><span>Ø§Ù„Ø®Ø¯Ù…Ø©:</span><span>${data.serviceType === 'Free' ? 'FREE SERVICE' : 'PAID SERVICE'}</span></div>
        ${data.amount > 0 ? `<div class="flex justify-between border-b pb-2"><span>Ø§Ù„Ù…Ø¨Ù„Øº:</span><span>${data.amount} SAR</span></div>` : ''}
    `;
    
    document.getElementById('cap-staff-name').innerText = currentUser.name;
    document.getElementById('cap-time').innerText = new Date().toLocaleString('en-US');

    // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ØµÙˆØ±Ø©
    const canvas = await html2canvas(cap, { scale: 2 });
    const link = document.createElement('a');
    link.download = `Invoice-${data.plateNum}.png`;
    link.href = canvas.toDataURL();
    link.click();


			if(data.phone !== '-' && data.phone.length >= 9) {
				const msg = encodeURIComponent(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${data.clientName}ØŒ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø³ÙŠØ§Ø±ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Mind Break.\nØ±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©: ${data.plateNum}\nØ±Ù‚Ù… Ø§Ù„ÙƒØ±Øª: ${data.cardNum}`);
				window.open(`https://wa.me/966${data.phone.startsWith('0') ? data.phone.substring(1) : data.phone}?text=${msg}`);
			}
		}

		async function loadReports() {
			const list = document.getElementById('reports-list');
			list.innerHTML = `<div class="text-center py-10 opacity-50 font-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>`;
			try {
				const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'getReports' }) });
				const reports = await res.json();
				list.innerHTML = '';
				reports.forEach(r => {
					const isParked = r.vehicleStatus === 'Parked';
					list.innerHTML += `
						<div class="invoice-card shadow-sm border-r-4 ${isParked ? 'border-orange-400' : 'border-green-500'}">
							<div class="flex justify-between items-center mb-2">
								<span class="text-xl font-black text-[#632323]">${r.plateNum}</span>
								<span class="text-[10px] font-bold px-2 py-1 rounded bg-gray-100 uppercase">${isParked ? 'ğŸ…¿ï¸ Parked' : 'âœ… Returned'}</span>
							</div>
							<div class="text-[11px] opacity-60 mb-4">
								<p>Ø§Ù„Ø¹Ù…ÙŠÙ„: ${r.clientName} ${r.serviceType === 'Free' ? '(Free)' : ''}</p>
								<p>Ø§Ù„ÙƒØ±Øª: #${r.cardNum} | Ø§Ù„Ù…ÙˆØ¸Ù: ${r.valet}</p>
							</div>
							<div class="flex gap-2">
								<button onclick='reExport(${JSON.stringify(r)})' class="flex-1 bg-gray-100 text-gray-800 py-2 rounded-lg text-[10px] font-black border border-gray-200">ØªØµØ¯ÙŠØ± Ø¥ÙŠØµØ§Ù„</button>
								${isParked ? `<button onclick="updateStatus('${r.plateNum}', 'Returned')" class="flex-1 bg-green-600 text-white py-2 rounded-lg text-[10px] font-black shadow-md shadow-green-100">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>` : ''}
							</div>
						</div>`;
				});
				lucide.createIcons();
			} catch(e) { list.innerHTML = "ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±"; }
		}

		async function updateStatus(plate, newStatus) {
			if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©ØŸ")) return;
			try {
				await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'updateVehicleStatus', plateNum: plate, status: newStatus }) });
				alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­");
				loadReports();
			} catch(e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£"); }
		}

		function reExport(r) {
			captureAndDownload({
				plateNum: r.plateNum, cardNum: r.cardNum, serviceType: r.serviceType, 
				clientName: r.clientName, phone: r.phone || '-', amount: r.amount || 0
			});
		}

		// --- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø¢Ø¯Ù…Ù† ---
		async function loadAttendanceSystem() {
			const list = document.getElementById('attendance-list');
			list.innerHTML = `<div class="text-center py-10 opacity-50 font-black">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†...</div>`;
			try {
				const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'getEmployees' }) });
				const emps = await res.json();
				list.innerHTML = "";
				emps.forEach(emp => {
					list.innerHTML += `
					<div class="glass p-4 mb-3 border border-gray-100 shadow-sm">
						<div class="flex justify-between items-center mb-3">
							<span class="text-[10px] bg-[#632323]/10 text-[#632323] px-2 py-1 rounded font-black">${emp.job}</span>
							<div class="font-black text-[#632323]">${emp.name}</div>
						</div>
						<div class="flex gap-2">
							<select id="stat-${emp.name}" class="flex-1 p-3 bg-white rounded-xl text-[11px] font-black">
								<option value="Present">Present</option>
								<option value="Absent">Absent</option>
							</select>
							<input type="number" id="hrs-${emp.name}" value="8" class="w-16 p-3 bg-white rounded-xl text-center font-bold">
							<button onclick="confirmAtt('${emp.name}')" class="bg-[#632323] text-white px-4 rounded-xl text-[11px] font-black active:scale-95 shadow-lg shadow-[#632323]/20">Ø­ÙØ¸</button>
						</div>
					</div>`;
				});
			} catch(e) { list.innerHTML = "ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„"; }
		}

		async function confirmAtt(name) {
			const data = { action: 'submitAttendance', employeeName: name, hours: document.getElementById(`hrs-${name}`).value, status: document.getElementById(`stat-${name}`).value, date: new Date().toLocaleDateString('en-CA'), submittedBy: currentUser.name };
			try {
				await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
				alert(`ØªÙ… ØªØ­Ø¶ÙŠØ± ${name}`);
			} catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"); }
		}

		function navTo(id) {
			document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
			document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active'));
			document.getElementById(id).classList.add('active');
			if(document.getElementById('nav-'+id)) document.getElementById('nav-'+id).classList.add('nav-active');
			if(id === 'reports') loadReports();
			if(id === 'attendance') loadAttendanceSystem();
		}

		lucide.createIcons();
		switchTab('mb');
	</script>
</body>
</html>
